{% extends "base.html" %}
{% block body %}
<div class="container mt-4">
  <h3>Novo Scan</h3>
  <p>Escolha o tipo de scan que pretende realizar:</p>

  <form method="POST" action="{{ url_for('do_scan') }}" id="scanForm">
    <div class="form-group mb-3">
      <label><strong>Tipo de Scan:</strong></label><br>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="scan_type" id="scanAll" value="all" checked>
        <label class="form-check-label" for="scanAll">Toda a Rede</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="scan_type" id="scanSpecific" value="specific">
        <label class="form-check-label" for="scanSpecific">IP Específico</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="scan_type" id="scanRange" value="range">
        <label class="form-check-label" for="scanRange">Intervalo de IPs</label>
      </div>
    </div>

    <div class="form-group mb-3" id="ipInputGroup" style="display: none;">
      <label for="ip_range">Endereço IP:</label>
      <input type="text" class="form-control" id="ip_range" name="ip_range" placeholder="Ex: 192.168.1.10">
    </div>

    <div class="form-group mb-3" id="ipRangeGroup" style="display: none;">
      <label for="ip_start">Intervalo de IPs:</label>
      <div class="input-group">
        <input type="text" class="form-control" id="ip_start" name="ip_start" placeholder="IP inicial (Ex: 192.168.1.10)">
        <span class="input-group-text">até</span>
        <input type="text" class="form-control" id="ip_end" name="ip_end" placeholder="IP final (Ex: 192.168.1.20)">
      </div>
    </div>

    <button type="submit" class="btn btn-primary" id="submitBtn">Iniciar Scan</button>

    <!-- Spinner escondido inicialmente -->
    <div id="loadingSpinner" style="display:none; margin-top: 10px;">
      <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> A processar...
    </div>
  </form>

<script>
  const scanAllRadio = document.getElementById('scanAll');
  const scanSpecificRadio = document.getElementById('scanSpecific');
  const scanRangeRadio = document.getElementById('scanRange');
  const ipInputGroup = document.getElementById('ipInputGroup');
  const ipRangeGroup = document.getElementById('ipRangeGroup');
  const ipInput = document.getElementById('ip_range');
  const form = document.getElementById('scanForm');
  const submitBtn = document.getElementById('submitBtn');
  const loadingSpinner = document.getElementById('loadingSpinner');

  // Mostra/oculta input IP conforme opção
  scanAllRadio.addEventListener('change', () => {
    ipInputGroup.style.display = 'none';
    ipRangeGroup.style.display = 'none';
  });

  scanSpecificRadio.addEventListener('change', () => {
    ipInputGroup.style.display = 'block';
    ipRangeGroup.style.display = 'none';
  });

  scanRangeRadio.addEventListener('change', () => {
    ipInputGroup.style.display = 'none';
    ipRangeGroup.style.display = 'block';
  });

  // Ao carregar a página, garante estado inicial
  window.addEventListener('load', () => {
    loadingSpinner.style.display = 'none';
    submitBtn.disabled = false;
  });

  // Intercepta o submit para mostrar spinner e desativar botão
  form.addEventListener('submit', (event) => {
    submitBtn.disabled = true;
    loadingSpinner.style.display = 'inline-flex';
  });
</script>
{% endblock %}